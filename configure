#!/bin/sh

# Configure script for the ttools library.  This 
# script asks some questions and attempts to discover 
# the location of needed libraries.

rm -rf Makefile
rm -rf config.h

# 
# Ask what kind of build we want to do.  The debug 
# option compiles with debugging, normal compiles with 
# no debugging, release compiles with no debugging and 
# optimized code.

echo -e "Build Type (debug,normal,release) [normal]: \c"
read BUILDTYPE
if [ "$BUILDTYPE" = "" ]; then
   BUILDTYPE="normal"
fi

#
# Prompt user for the version, providing a default value.

TEMPVERSION=$(cat version.txt)
echo -e "Version ["$TEMPVERSION"]: \c"
read IMVERSION
if [ "$IMVERSION" = "" ]; then
   IMVERSION="$TEMPVERSION"
fi
echo $IMVERSION > version.txt

#
# Find the threadlibs - right now does nothing, we'll improve 
# on it later when needed.

THREADLIB="-lpthread"

#
# Create the cflags

if [ "$BUILDTYPE" = "debug" ]; then
   TT_CFLAGS="-g -Wall"
elif [ "$BUILDTYPE" = "normal" ]; then
   TT_CFLAGS="-Wall"
else
   TT_CFLAGS="-Wall -O7"
fi

# Generate the makefile

echo "#" > Makefile
echo "# Makefile autogenerated by ./configure" >> Makefile
echo "" >> Makefile

echo TT_THREAD_LIB = $THREADLIB >> Makefile
echo TT_CFLAGS = $TT_CFLAGS >> Makefile
echo "" >> Makefile
cat Makefile.in >> Makefile
